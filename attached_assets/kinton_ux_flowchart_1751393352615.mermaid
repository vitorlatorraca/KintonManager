flowchart TD
    A[Abrir App] --> B{Usu√°rio logado?}
    
    %% Fluxo de Login/Cadastro
    B -->|N√£o| C[Tela de Login]
    C --> D[Inserir celular e senha]
    D --> E{Dados v√°lidos?}
    E -->|N√£o| F[Mostrar erro<br/>Tentar novamente]
    F --> D
    E -->|Sim| G{Primeiro acesso?}
    G -->|Sim| H[Tela de Boas-vindas<br/>Tutorial r√°pido]
    H --> I[Dashboard Principal]
    G -->|N√£o| I
    
    %% Op√ß√£o de cadastro
    C --> J[N√£o tem conta?<br/>Cadastre-se]
    J --> K[Tela de Cadastro]
    K --> L[Inserir: Nome, Celular, Senha]
    L --> M{Dados v√°lidos?}
    M -->|N√£o| N[Mostrar erro<br/>Corrigir dados]
    N --> L
    M -->|Sim| O[Conta criada!<br/>Login autom√°tico]
    O --> H
    
    %% Esqueci senha
    C --> P[Esqueci minha senha]
    P --> Q[Inserir celular]
    Q --> R[Enviar SMS com c√≥digo]
    R --> S[Inserir c√≥digo SMS]
    S --> T{C√≥digo v√°lido?}
    T -->|N√£o| U[C√≥digo inv√°lido<br/>Tentar novamente]
    U --> S
    T -->|Sim| V[Criar nova senha]
    V --> W[Senha alterada!<br/>Fazer login]
    W --> C
    
    %% Dashboard Principal (Cliente)
    B -->|Sim| AA{Tipo de usu√°rio?}
    AA -->|Cliente| I[Dashboard Principal]
    I --> BB[Mostrar:<br/>‚Ä¢ Stamps atuais X/10<br/>‚Ä¢ Barra de progresso<br/>‚Ä¢ Gyozas dispon√≠veis<br/>‚Ä¢ Bot√£o Gerar QR]
    
    %% A√ß√µes do Dashboard
    BB --> CC[Gerar QR Code]
    BB --> DD[Ver Hist√≥rico]
    BB --> EE[Resgatar Recompensa]
    BB --> FF[Perfil/Configura√ß√µes]
    
    %% Fluxo QR Code
    CC --> GG[Tela QR Code]
    GG --> HH[Mostrar QR grande<br/>Timer de expira√ß√£o<br/>Instru√ß√µes para uso]
    HH --> II{QR foi escaneado?}
    II -->|Sim| JJ[‚úÖ Stamp adicionado!<br/>Mostrar anima√ß√£o]
    JJ --> KK{Atingiu 10 stamps?}
    KK -->|Sim| LL[üéâ Parab√©ns!<br/>Gyoza gr√°tis dispon√≠vel!]
    LL --> MM[Ir para Dashboard<br/>Stamp counter: 0/10<br/>+1 Gyoza dispon√≠vel]
    KK -->|N√£o| NN[Voltar ao Dashboard<br/>Contador atualizado]
    II -->|Expirou| OO[QR Code expirado<br/>Gerar novo?]
    OO --> CC
    
    %% Hist√≥rico de Stamps
    DD --> PP[Tela Hist√≥rico]
    PP --> QQ[Lista de stamps:<br/>‚Ä¢ Data/hora<br/>‚Ä¢ Local<br/>‚Ä¢ Status]
    QQ --> RR[Voltar ao Dashboard]
    RR --> I
    
    %% Resgate de Recompensa
    EE --> SS{Tem gyoza dispon√≠vel?}
    SS -->|N√£o| TT[Nenhuma recompensa<br/>dispon√≠vel ainda]
    TT --> I
    SS -->|Sim| UU[Tela de Recompensas]
    UU --> VV[Mostrar gyozas dispon√≠veis<br/>Bot√£o: Resgatar]
    VV --> WW[Confirmar resgate?]
    WW --> XX{Confirmou?}
    XX -->|N√£o| UU
    XX -->|Sim| YY[Gyoza resgatada!<br/>Mostrar QR de resgate<br/>Levar ao caixa]
    YY --> ZZ[Voltar ao Dashboard<br/>Gyoza removida da lista]
    ZZ --> I
    
    %% Perfil/Configura√ß√µes
    FF --> AAA[Tela Perfil]
    AAA --> BBB[Mostrar:<br/>‚Ä¢ Nome, telefone<br/>‚Ä¢ Alterar senha<br/>‚Ä¢ Hist√≥rico de resgates<br/>‚Ä¢ Logout]
    BBB --> CCC[Alterar dados]
    BBB --> DDD[Ver resgates anteriores]
    BBB --> EEE[Sair da conta]
    CCC --> FFF[Salvar altera√ß√µes]
    FFF --> AAA
    DDD --> GGG[Lista de resgates<br/>com datas]
    GGG --> AAA
    EEE --> HHH[Logout confirmado]
    HHH --> A
    
    %% Dashboard Manager
    AA -->|Manager| III[Dashboard Manager]
    III --> JJJ[Tela Scanner QR]
    JJJ --> KKK[C√¢mera ativa<br/>Instru√ß√£o: Aponte para QR do cliente]
    KKK --> LLL{QR detectado?}
    LLL -->|N√£o| MMM[Continuar escaneando]
    MMM --> KKK
    LLL -->|Sim| NNN{QR v√°lido?}
    NNN -->|N√£o| OOO[‚ùå QR inv√°lido ou expirado<br/>Pedir novo QR]
    OOO --> KKK
    NNN -->|Sim| PPP[Mostrar dados do cliente:<br/>Nome, stamps atuais]
    PPP --> QQQ[Confirmar adi√ß√£o<br/>de stamp?]
    QQQ --> RRR{Confirmou?}
    RRR -->|N√£o| KKK
    RRR -->|Sim| SSS[‚úÖ Stamp adicionado!<br/>Cliente: X/10 stamps]
    SSS --> TTT{Cliente completou 10?}
    TTT -->|Sim| UUU[üéâ Cliente ganhou gyoza!<br/>Avisar cliente]
    TTT -->|N√£o| VVV[Stamp registrado<br/>Continuar]
    UUU --> VVV
    VVV --> KKK
    
    %% Logout Manager
    III --> WWW[Sair da conta]
    WWW --> A
    
    %% Estados de erro/offline
    subgraph Tratamento de Erros
        XXX[Sem internet]
        YYY[Erro no servidor]
        ZZZ[QR corrompido]
        AAAA[Timeout]
    end
    
    %% Notifica√ß√µes Push
    subgraph Notifica√ß√µes
        BBBB[Stamp adicionado]
        CCCC[Gyoza dispon√≠vel]
        DDDD[Recompensa expirando]
        EEEE[Promo√ß√£o especial]
    end
    
    %% Styling
    classDef clientFlow fill:#e1f5fe
    classDef managerFlow fill:#f3e5f5
    classDef successState fill:#e8f5e8
    classDef errorState fill:#ffebee
    classDef decisionState fill:#fff3e0
    
    class I,BB,CC,DD,EE,FF,GG,HH clientFlow
    class III,JJJ,KKK,PPP,QQQ managerFlow
    class JJ,LL,MM,YY,SSS,UUU successState
    class F,N,U,OO,TT,OOO errorState
    class B,E,G,M,T,AA,II,KK,SS,XX,LLL,NNN,RRR,TTT decisionState